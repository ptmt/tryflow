<!DOCTYPE html>
<html lang="en">
<head>
<title>Try Flow:Â Learn and share JavaScript snippets using type annotations</title>
<link rel='shortcut icon' href='favicon.png'>
<meta name="description" content="Learn Flow by examples, write and share your own code snippets with a static type checker in JavaScript." />
<meta name="twitter:card" value="Learn Flow by examples, write and share your own code snippets with a static type checker in JavaScript.">
<meta property="og:title" content="Try Flow" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tryflow.org/" />
<meta property="og:description" content="Learn Flow by examples, write and share your own code snippets with a static type checker in JavaScript." />
<style type="text/css" media="screen">
    #editor {
      position: absolute;
      top: 0;
      right: 30%;
      bottom: 30px;
      padding-bottom: 30px;
      left: 0;
      margin:0;
      height: 100%;
      font-size: 15px;
      font-family: 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;
    }
    .navigation {
      position: absolute;
      background: #fff;
      border-left: solid 8px #bde2b1;
      font-family: 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;
      font-size: 13px;
      top: 0;
      left: 70%;
      height: 100%;
      width: 30%;
    }
    .pure-tree {
      text-align: left;
      display: block;
    }
    .pure-tree.main-tree {
      display: inline-block;
      padding-left: 1.5em;
    }
    .pure-tree:not(.main-tree) {
      padding-left: 1.2em;
      /*margin-top: 1em;*/
    }
    .pure-tree:not(.main-tree) li {
      overflow: hidden;
      height: 0;
      display: block;
    }
    .pure-tree label {
      display: block;
      cursor: pointer;
      color: #717780;
    }
    .pure-tree label:before {
      width: 1em;
      height: 1em;
      line-height: 2em;
      display: inline-block;
      font-family: 'Ionicons', sans-serif;
      content: "\f434";
      padding-right: 0.25em;
    }
    .pure-tree .pure-tree_link a:before{
      width: 1em;
      height: 1em;
      line-height: 2em;
      display: inline-block;
      font-family: 'Ionicons', sans-serif;
      content: "\f391";
      padding-right: 0.2em;
    }
    .pure-tree .pure-tree_link a.active {
      color: black;
      font-weight: 700;
    }
    .pure-tree label:hover {
      color: black;
      border-bottom-color: black;
    }
    .pure-tree .pure-tree_link a {
      padding: 0.25em 1.125em 0.25em 0;
      display: block;
      border-radius: .2em;
      color: #3D4653;
      text-decoration: none;
    }
    .pure-tree .pure-tree_link a:hover {
      color: black;
    }
    .pure-tree.nested {
      padding-left: 1em;
    }
    .pure-tree [type="checkbox"] {
      display: none;
    }
    .pure-tree [type="checkbox"]:checked + label {
      color: black;
      border-bottom-color: black;
    }
    .pure-tree [type="checkbox"]:checked ~ ul > li {
      height: auto;
    }
    .navigation li {
      list-style-type: none;
    }
    .marker-highlight-error {
      position: absolute;
      border-bottom: dashed 1px red;
      z-index: 1000;
    }
    .overlay {
      background: #333;
      opacity: 0.8;
      border-top: 1px solid #444;
      padding: 6px 12px;
      font-family: 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;;
      position: fixed;
      bottom: 0;
      left: 0;
      z-index: 1000;
      width: 100%;
      color: #ccc;
      font-size: 12px;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }
    .overlay .info {
      font-size: 12px;
      font-style: italic;
      color: white;
    }
    .overlay .right {
      margin-right: 20px;
    }
    .overlay a {
      color: white
    }
</style>
<link rel="stylesheet" type="text/css" media="screen" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" />
</head>
<body>

<div id="editor">
</div>

<div class="navigation">
  <ul id="compositions-list" class="pure-tree main-tree">
  <li>
    <input type="checkbox" id="trigger-views" checked="checked">
    <label for="trigger-views">Basics</label>
    <ul class="pure-tree">
      <li class="pure-tree_link"><a href="/#1">01-Untyped.js</a></li>
      <li class="pure-tree_link"><a href="/#2">02-Untyped-constants.js</a></li>
      <li class="pure-tree_link"><a href="/#3">03-Basic-typed.js</a></li>
      <li class="pure-tree_link"><a href="/#4">04-Dynamic-object-keys.js</a></li>
      <li class="pure-tree_link"><a href="/#5">05-Function-types.js</a></li>
      <li class="pure-tree_link"><a href="/#6">06-Recap.js</a></li>
      <li class="pure-tree_link"><a href="/#7">07-Maybe-and-optionals.js</a></li>
    </ul>
  </li>
  <li>
    <input type="checkbox" id="trigger-node" checked="checked">
    <label for="trigger-node">Node.js</label>
    <ul class="pure-tree">
      <li class="pure-tree_link"><a href="/#1">(Coming soon)</a></li>
    </ul>
  </li>
  <li>
    <input type="checkbox" id="trigger-react" checked="checked">
    <label for="trigger-react">React</label>
    <ul class="pure-tree">
      <li class="pure-tree_link"><a href="/#1">(Coming soon)</a></li>
    </ul>
  </li>
 </ul>
</div>

<div class="overlay">
  <span class="status">Loading core libs...</span>
  <span class="info"></span>
  <span class="right">
    &copy; <span class="version">Flow</span> <a id="footer-link" href="https://tryflow.org/">tryflow.org</a>
  </span>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/mode-typescript.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.min.js" type="text/javascript" charset="utf-8"></script>

<script>
  var isEmbedded = false;
  var flowReady = false;
  var flowWorker = new Worker("js/worker.js");

  function onReady(fn) {
    if (document.readyState != 'loading'){
      fn();
    } else {
      document.addEventListener('DOMContentLoaded', fn);
    }
  }

  function init() {
    function flowCheckContents(annotations) {
      try {
        var session = editor.getSession();
        Object.keys(session.$backMarkers).forEach(function(r) {  session.removeMarker(r) })
        session.setAnnotations(annotations);
          var Range = ace.require("ace/range").Range
          annotations.forEach(function(error) {
            session.addMarker(
              new Range(error.row, error.column, error.row, error.columnEnd + 1), 'marker-highlight-error', 'background'
            );
          })
      } catch (e) {
        console.log(e)
      }
    }

    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/tomorrow_night");
    editor.getSession().setMode("ace/mode/typescript");

    function runFlowCheck(e) {
        flowWorker.postMessage({
          flowCheck: true,
          text: editor.getValue()
        })
        var linkEnding = '/?code=' + btoa(editor.getValue());
        if (!isEmbedded) {
          history.pushState({}, "Tryflow", linkEnding);
        }
        document.querySelector('#footer-link').href = 'https://tryflow.org' + linkEnding;
    }

    function locationHashChanged() {
      var number = location.hash ? parseInt(location.hash.replace('#',''), 10) : 1;
      [].forEach.call(document.querySelectorAll('.active'), function(div) {
        div.className = '';
      });
      fetch('/examples/' + number + '.js')
        .then(function(r) { return r.text()})
        .then(function(r) {
          editor.setValue(r);
          editor.scrollToLine(0, true, false, function() {})
          editor.selection.moveCursorToPosition({row: 0, column: 0});
        })
      if (!isEmbedded) {
        document.querySelectorAll('a[href="/#' + number + '"]')[0].className = 'active'
      }
    }

    function parseQuery() {
      if (document.location.href.indexOf('?iframe=') > -1) {
        document.querySelector('.navigation').remove();
        document.querySelector('#editor').style.right = 0;
        isEmbedded = true;
      }
      if (document.location.href.indexOf('code=') > -1) {
        var code = atob(decodeURIComponent(document.location.href.split('code=')[1]))
        editor.setValue(code);
        editor.scrollToLine(0, true, false, function() {})
        editor.selection.moveCursorToPosition({row: 0, column: 0});
      } else {
        locationHashChanged()
      }
    }

    editor.selection.on("changeCursor", function() {
      if (flowReady) {
        var cursor = editor.getCursorPosition()
        flowWorker.postMessage({
          inferTypeAt: cursor,
          text: editor.getValue(),
        })
      }
    })

    editor.$blockScrolling = Infinity;
    parseQuery();
    window.addEventListener("hashchange", locationHashChanged, false);

    flowWorker.onmessage = function(e) {
      if (e.data.flowVersion) {
        document.querySelector('.version').innerHTML = 'Flow v' + e.data.flowVersion;
      }
      if (e.data.flowReady) {
        flowReady = true;
        runFlowCheck();
        document.querySelector('.status').innerHTML = 'Ready!';
        editor.getSession().on('change', runFlowCheck);
      }
      if (e.data.inferredType) {
        var cursor = editor.getCursorPosition()
        var type = e.data.inferredType;
        document.querySelector('.info').innerHTML = type;
      }
      if (e.data.flowCheck) {
        flowCheckContents(e.data.flowResults);
      }
    }

  }

  onReady(init)
</script>
</body>
</html>
